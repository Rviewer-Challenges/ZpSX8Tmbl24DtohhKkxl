(window.webpackJsonp=window.webpackJsonp||[]).push([[240],{VeNJ:function(e,t,n){"use strict";n.r(t),n.d(t,"EmptyState",(function(){return he})),n.d(t,"TimelineRenderer",(function(){return de}));n("kYxP");var i=n("ejT/"),s=n("ERkP"),r=n.n(s),o=n("5UID"),a=n("6/RC"),c=n("1YZw"),l=n("rxPX"),h=Object(l.a)().propsFromActions((()=>({addToast:c.b}))).withAnalytics(),d=n("KNCp"),p=n("lUZE");var m=Object.freeze({Icon:"Icon",IconSmall:"IconSmall",FullWidth:"FullWidth"}),_=n("caTy"),u=n("rcen"),v=n("TnY3"),y=n("TIdA"),b=n("A91F"),g=n("feu+"),C=n("tI3i"),f=n.n(C),w=a.canUseDOM?window.location.href:"",E=function(){function e(){var e=this;this._eventCallbacks={},this.addEventListener=function(t,n){e._eventCallbacks[t]?e._eventCallbacks[t].push(n):e._eventCallbacks[t]=[n]},this.removeEventListener=function(t,n){var i=e._eventCallbacks[t].filter((function(e){return e.toString()!==n.toString()}));e._eventCallbacks[t]=i}}var t=e.prototype;return t._dispatchEvent=function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];var s=this._eventCallbacks[e];null!=s&&Array.isArray(s)&&s.map((function(e){e.apply(void 0,n)}))},t.canOpenURL=function(){return Promise.resolve(!0)},t.getInitialURL=function(){return Promise.resolve(w)},t.openURL=function(e){try{return I(e),this._dispatchEvent("onOpen",e),Promise.resolve()}catch(e){return Promise.reject(e)}},t._validateURL=function(e){f()("string"==typeof e,"Invalid URL: should be a string. Was: "+e),f()(e,"Invalid URL: cannot be empty")},e}(),I=function(e){if(a.canUseDOM){var t=new URL(e,window.location).toString();window.open(t,"_blank","noopener")}},T=new E,S=n("MWbm"),k=n("zTrU"),R=n("fs1G");class L extends r.a.PureComponent{constructor(...e){super(...e),this._getGraphicProps=Object(k.a)(((e,t)=>{const n=e?({style:t})=>r.a.createElement(S.a,{style:t},r.a.createElement(y.a,{accessibilityLabel:"",aspectMode:b.a.exact(e.width/e.height),image:e})):p.a;let i="illustration";return e&&t!==m.IconSmall?t===m.FullWidth&&(i="illustrationFullWidth"):i="icon",{graphic:n,graphicDisplayMode:i}})),this._scribeAction=(e,t)=>{const{analytics:n}=this.props,{action:i,component:s,element:r}=t||{};n.scribe({action:i||e,component:s||"cover",element:r})},this._handleDismiss=()=>{const{dismissInfo:e,processCallback:t}=this.props,{callbacks:n}=e||{};n&&n.forEach((e=>{t(e)})),e&&(this._scribeAction("dismiss"),this.props.onClose())},this._handlePrimaryCtaClick=()=>{this._handleCtaClick(this.props.primaryCta,"primary_cta")},this._handleSecondaryCtaClick=()=>{this.props.secondaryCta&&this._handleCtaClick(this.props.secondaryCta,"secondary_cta")},this._handleCtaClick=({callbacks:e,clientEventInfo:t,ctaBehavior:n},i)=>{const{addToast:s,history:r,processCallback:o}=this.props;if(this.props.onClose(),this._scribeAction("click",{element:i,...t}),n.dismiss){const{dismiss:e}=n;e&&e.feedbackMessage&&s({text:e.feedbackMessage.text})}if(n.navigate){const{navigate:e}=n,t=e&&Object(_.b)(e.url);t&&(t.external?T.openURL(t.pathname):r.push(t.pathname))}e&&e.forEach((e=>o(e)))}}componentDidMount(){this.props.onImpression&&this.props.onImpression()}render(){const{details:e,dismissInfo:t,displayType:n,image:i,imageDisplayType:s,primaryCta:o,primaryText:a,secondaryCta:c,secondaryText:l,type:h}=this.props,p=r.a.createElement(u.a,{entities:a.entities,text:a.text}),m=l?r.a.createElement(u.a,{entities:l.entities,text:l.text}):null,{graphic:_,graphicDisplayMode:v}=this._getGraphicProps(i,s);if(h===d.a.Full){const i=e?r.a.createElement(u.a,{entities:e.entities,text:e.text}):null;return r.a.createElement(g.a,{actionLabel:o.text,footer:i,graphic:_,graphicDisplayMode:v,headline:p,isFullHeightOnMobile:!t&&"CenterCover"!==n,onAction:this._handlePrimaryCtaClick,onClose:this._handleDismiss,onTertiaryAction:this._handleSecondaryCtaClick,subtext:m,tertiaryActionLabel:c&&c.text,withCloseButton:!!t})}return r.a.createElement(g.a,{actionLabel:o.text,graphic:_,graphicDisplayMode:"illustrationFullWidth"===v?v:"none",headline:p,onAction:this._handlePrimaryCtaClick,onClose:R.a,onSecondaryAction:this._handleSecondaryCtaClick,secondaryActionLabel:c&&c.text,subtext:m,withCloseButton:!1})}}L.defaultProps={imageDisplayType:m.Icon};var A=Object(v.a)(h(L)),x=n("Irs7");const O={component:"cover",action:"impression"};var N=({activeCover:e,clearActiveCover:t,processCallback:n})=>{const i=(e=>{let t={...O};return e&&(e.component&&(t={...t,component:e.component}),e.element&&(t={...t,element:e.element}),e.action&&(t={...t,action:e.action})),t})(e.clientEventInfo),s=Object(x.b)(),o=()=>{const{cover:{impressionCallbacks:t}}=e;t&&t.forEach((e=>n(e))),s.scribe({...i})};return"full"===e.type?(a=e.cover,r.a.createElement(A,{details:a.details||void 0,dismissInfo:a.dismissInfo,displayType:a.displayType,image:a.image,imageDisplayType:a.imageDisplayType||void 0,onClose:t,onImpression:o,primaryCta:a.primaryCoverCta,primaryText:a.primaryText,processCallback:n,secondaryCta:a.secondaryCoverCta,secondaryText:a.secondaryText,type:"full"})):"half"===e.type?function(e){const i="CenterCover"===e.displayType?"full":"half";return r.a.createElement(A,{displayType:e.displayType,image:e.coverImage?e.coverImage.image:void 0,imageDisplayType:e.coverImage?e.coverImage.imageDisplayType:void 0,onClose:t,onImpression:o,primaryCta:e.primaryCoverCta,primaryText:e.primaryText,processCallback:n,secondaryCta:e.secondaryCoverCta,secondaryText:e.secondaryText,type:i})}(e.cover):null;var a},D=n("MDbM");const M={threshold:[.01,.5]};var F=class{constructor(e){this._itemsUnderObservation={},this._lingerCandidates=new Map,this._reactivityCandidates=new Map,this._lingerEvents=new Map,this._impressionEvents=new Map,this.getLingerEvents=(e=Date.now())=>Array.from(this._lingerEvents.keys()).map((e=>this._getLingerEventForId(e))).filter(Boolean),this._getLingerEventForId=e=>{const t=this._lingerEvents.get(e);if(t&&!t.scribed)return this._lingerEvents.set(e,{...t,scribed:!0}),{id:e,start:t.start,end:t.end}},this._getOngoingLingerEvents=e=>{const t=[];return this._lingerCandidates.forEach(((n,i)=>{e-n>=500&&t.push({id:i,start:n,end:e})})),t},this._processIntersectionEntries=e=>{const t=Date.now();e.forEach((e=>{const n=Object.entries(this._itemsUnderObservation).find((([t,n])=>n===e.target));if(n){const r=n[0],{boundingClientRect:o,intersectionRatio:a,rootBounds:c}=e;if(a>=.01){const e=null!=o&&null!=c;this._createImpressionCandidate(r,e?(i=o.height,s=c.height,Math.floor(i/s*1e5)):void 0)}a>=.5?(this._createLingerCandidate(r,t),this._createReactivityCandidate(r,t)):(this._transitionCandidateToLingerEvent(r,t),this._removeReactivityCandidate(r))}var i,s}))},this._createImpressionCandidate=(e,t)=>{this._impressionEvents.set(e,{relativeElementHeight:t})},this._createLingerCandidate=(e,t)=>{this._lingerCandidates.has(e)||this._lingerCandidates.set(e,t)},this._transitionCandidateToLingerEvent=(e,t)=>{const n=this._lingerCandidates.get(e);void 0===n||this._lingerEvents.has(e)||t-n>=500&&this._lingerEvents.set(e,{start:n,end:t,scribed:!1}),this._lingerCandidates.delete(e)},this._createReactivityCandidate=(e,t)=>{if(!this._reactivityCandidates.has(e)){const t=window.setTimeout((()=>{this._reactivityCallback(e),this._reactivityCandidates.delete(e)}),500);this._reactivityCandidates.set(e,t)}},this._removeReactivityCandidate=e=>{window.clearTimeout(this._reactivityCandidates.get(e)),this._reactivityCandidates.delete(e)},null!=e&&e.root&&e.root===window.document&&(e.root=null);const t={...M,...e};this._observer=new IntersectionObserver(this._processIntersectionEntries,t),this._reactivityCallback=e&&e.reactivityCallback||R.a}observe(e,t){e&&(this._itemsUnderObservation[t]=e,this._observer.observe(e))}unobserve(e,t){e&&(this._observer.unobserve(e),delete this._itemsUnderObservation[t],this._removeReactivityCandidate(t))}disconnect(){this._observer.disconnect()}getImpressionEvents(){const e=Array.from(this._impressionEvents,(([e,t])=>({id:e,relativeElementHeight:t.relativeElementHeight})));return this._impressionEvents.clear(),e}flushLingerEvents(e=Date.now()){const t=this.getLingerEvents(e),n=this._getOngoingLingerEvents(e);return this._lingerCandidates.clear(),t.concat(n)}},P=n("LFzM");var U=({children:e,impressionTracker:t})=>t?r.a.createElement(P.a.Provider,{value:{impressionTracker:t}},e):e,B=n("3GUV"),H=n("v//M"),j=n("rHpw"),V=n("VPAj"),W=n("0zXz");const z=Object(V.a)(r.a.createElement(B.a,null)),K=({bottomFetchStatus:e,onBottomRetry:t,withEndOfContent:n})=>r.a.createElement(S.a,{style:n&&G.footer},r.a.createElement(H.a,{fetchStatus:e,onRequestRetry:t,render:n?z:W.a})),G=j.a.create((e=>({footer:{height:5*e.lineHeightsPx.body}})));var q=r.a.memo(K),J=n("xjVt"),Y=n("EUHl"),X=n("IG4P"),Z=n("iBK2"),Q=n("pbku"),$=n("aITJ"),ee=n("aWzz"),te=n("iChn"),ne=n("Qyxo"),ie=n("8UdT"),se=n("cFgU"),re=n("WA1W");const oe=e=>e.entryId,ae=e=>e.sortIndex;const ce=new Map,le=e=>{switch(e){case ie.c.Tweet:return $.b.isDesktopOS()?250:400;case ie.a.ModuleImpressionPlaceholder:return 0;default:return 100}};function he({analytics:e,renderEmptyState:t,richScribeAction:n}){return r.a.useEffect((()=>{n({...e.contextualScribeNamespace,action:"empty"},e.contextualScribeData)}),[n,e]),t()}class de extends r.a.PureComponent{constructor(e,t){var n;super(e,t),this._promotedTweetDistanceMap=new Map,this._renderFooter=()=>{const{bottomFetchStatus:e,footer:t=null,onBottomRetry:n,showLoadingFooter:i}=this.props;return i?r.a.createElement(r.a.Fragment,null,r.a.createElement(q,{bottomFetchStatus:e,onBottomRetry:n,withEndOfContent:!t}),t):t},this._refreshControlWrapper=e=>{const{canRefresh:t,onRefresh:n,refreshControl:i,topFetchStatus:s}=this.props;return i?r.a.createElement(i,{canRefresh:t,isRefreshing:s===D.a.LOADING,onRefresh:n},e):e},this._getCellRenderer=Object(k.a)(((e,t)=>{let n;const i={module:t,renderEntry:e=>n(e)};return n=(t,n)=>{const s=e.getHandler(t),r=e.getDisplayType(t)||void 0;return s&&s.render?s.render(t,i,n,r):null},n})),this._getInitialFocusedEntry=Object(k.a)(((e,t)=>t&&e.find(t))),this._createEntryIndex=Object(k.a)((e=>Object(te.a)(e,(e=>e.entryId)))),this._handleBeforeWindowUnload=()=>{this._flushLingerScribes()},this._handleKeyboardRefresh=()=>{this.refreshOrGoTop(!0)},this.scrollToTop=e=>{if(this._scroller){const{applyNewTweetsBarInstructions:t}=this.props;t&&t(),this._scroller.scrollToNewest(e)}},this._handleAtBottom=this._proximityHandler((()=>{this.props.onAtBottom&&this.props.onAtBottom()})),this._handleNearBottom=this._proximityHandler((()=>{this.props.onNearBottom()})),this._handleNearTop=this._proximityHandler((()=>{const{onNearTop:e}=this.props;e()})),this._handleAtTop=this._proximityHandler((()=>{const{analytics:e,onAtTop:t,removeAlert:n,richScribeAction:i}=this.props;n&&n(),t&&t();i({...e.contextualScribeNamespace,component:"stream",element:"top",action:"show"})})),this._handleItemsRendered=this._proximityHandler((({positions:e,viewport:t})=>{this.props.onEntriesRendered&&this.props.onEntriesRendered(),this._handleProcessLingerAndImpressionEvents()})),this._scribeImpressionEvents=e=>{var t;const n=this._getEntryIndex(),i=null==(t=this.context.featureSwitches)?void 0:t.isTrue("responsive_web_element_size_impression_scribe_enabled"),s=Object(ne.a)(e,(e=>{const t=n[e.id];return null!=t?{entry:t,relativeElementHeight:i?e.relativeElementHeight:void 0}:null}));this._scribeNewEntries(s)},this._handleProcessLingerAndImpressionEvents=()=>{if(this._impressionTrackerV2){var e;const t=this._impressionTrackerV2.getLingerEvents();this._scribeLingerEvents(t);const n=(null==(e=this._impressionTrackerV2)?void 0:e.getImpressionEvents())||[];this._scribeImpressionEvents(n)}},this._handleOnLingerEvent=e=>{const{applyReactionInstructions:t}=this.props,n=this._getEntryIndex()[e];n&&t({entry:n,triggerName:Q.a.ON_LINGER})},this._handlePositionRestored=()=>{this._positionedRestored=!0},this._scheduleNewEntriesScribing=(n=e=>{const{analytics:t,richScribeAction:n}=this.props,i=this._buildStreamScribeData(e);i.length>0&&n({...t.contextualScribeNamespace,component:"stream",action:"results"},{items:i})},a.canUseDOM&&window.requestIdleCallback?e=>{const t=window.requestIdleCallback((()=>n(e)));return()=>window.cancelIdleCallback(t)}:a.canUseDOM&&window.requestAnimationFrame?e=>{const t=window.requestAnimationFrame((()=>n(e)));return()=>window.cancelAnimationFrame(t)}:()=>R.a),this._setScroller=e=>{this._scroller=e},this._newImpressionTrackerV2=()=>a.canUseDOM&&window.IntersectionObserver?new F({root:this.context.viewport.getViewport(),rootMargin:this.context.viewport.getRootMargin(),reactivityCallback:this._handleOnLingerEvent}):void 0,this._streamScribeCancelCallbacks=[],this._impressionTrackerV2=this._newImpressionTrackerV2()}UNSAFE_componentWillReceiveProps(e){this.props.timelineId!==e.timelineId&&(this._flushLingerScribes(),this._impressionTrackerV2&&this._impressionTrackerV2.disconnect(),this._impressionTrackerV2=this._newImpressionTrackerV2())}componentDidMount(){const{onRef:e}=this.props;this._initialize(),window.addEventListener("beforelogout",this._handleBeforeWindowUnload),window.addEventListener("beforeunload",this._handleBeforeWindowUnload),e&&e(this)}componentWillUnmount(){var e;const{onRef:t}=this.props;this._flushLingerScribes(),this._cancelStreamScribeCallbacks(),window.removeEventListener("beforelogout",this._handleBeforeWindowUnload),window.removeEventListener("beforeunload",this._handleBeforeWindowUnload),t&&t(void 0),null==(e=this._impressionTrackerV2)||e.disconnect()}componentDidUpdate(e){const{entries:t,handlerRegistry:n,onRef:i,timelineId:s}=this.props;s!==e.timelineId?this._initialize():t===e.entries&&n===e.handlerRegistry||this._initialize(),i&&i!==e.onRef&&i(this)}render(){var e;const{anchoring:t,entries:n,handlerRegistry:s,header:a,isInitialFocusEntry:c,module:l,nearStartProximityRatio:h,renderEmptyState:d,timelineId:p,title:m,withKeyboardShortcuts:_,withoutHeadroom:u}=this.props,v=this.props.scroller,y=this._getInitialFocusedEntry(n,c);return this._refreshControlWrapper(this._shouldRenderEmptyState(n)?r.a.createElement(he,{analytics:this.props.analytics,key:`empty-${p}`,renderEmptyState:d,richScribeAction:this.props.richScribeAction}):r.a.createElement(U,{impressionTracker:this._impressionTrackerV2},r.a.createElement(o.a,{title:m},this._renderActiveCover(),this._renderPill(),r.a.createElement(v,{anchoring:t,assumedItemHeight:le,cacheKey:p,footer:this._renderFooter(),hasNewContentAtBottom:null==(e=this.context.featureSwitches)?void 0:e.isTrue("responsive_web_do_not_launch_me_reverse_home_timeline_enabled"),header:a,identityFunction:oe,initialAnchor:y&&i.b(oe(y)),items:n,nearStartProximityRatio:h,onAtEnd:this._handleAtBottom,onAtStart:this._handleAtTop,onItemsRendered:this._handleItemsRendered,onKeyboardRefresh:this._handleKeyboardRefresh,onNearEnd:this._handleNearBottom,onNearStart:this._handleNearTop,onPositionRestored:this._handlePositionRestored,ref:this._setScroller,renderer:this._getCellRenderer(s,l),sortIndexFunction:ae,withKeyboardShortcuts:_,withoutHeadroom:u}))))}_renderPill(){const{alert:e,applyNewTweetsBarInstructions:t,newTweetsPillLabel:n,newTweetsPillMode:i,removeAlert:s,timelineId:o,topUnseenCount:a}=this.props;var c;return i===Y.a.URT?r.a.createElement(J.a.Configure,{alert:e,applyNewTweetsBarInstructions:t,isAtNewest:null==(c=this._scroller)?void 0:c.isAtNewest,label:n,removeAlert:s,timelineId:o}):i===Y.a.CLIENT&&a&&a>0?r.a.createElement(J.a.Configure,{applyNewTweetsBarInstructions:t,removeAlert:s,timelineId:o,unreadCount:a}):null}_renderActiveCover(){const{activeCover:e,clearActiveCover:t,processCallback:n}=this.props,i=e&&e.cover;return e&&i?r.a.createElement(N,{activeCover:e,clearActiveCover:t,processCallback:n}):null}_shouldRenderEmptyState(e){const{activeCover:t,hasPendingHandlers:n,initialFetchStatus:i}=this.props,s=i===D.a.LOADED,r=0===e.length;return s&&r&&!t&&!n}_getEntryIndex(){return this._createEntryIndex(this.props.entries)}_initialize(){this._createPromotedTweetDistanceMap()}_createPromotedTweetDistanceMap(){const{entries:e}=this.props;this._promotedTweetDistanceMap=new Map;let t=null;e.forEach((e=>{var n;let i=!1;null!=(n=e.content)&&n.promotedMetadata&&(i=e.content.promotedMetadata),i&&null!==t&&this._promotedTweetDistanceMap.set(e.entryId,t),i?t=0:null!==t&&-1===e.type.indexOf("ui_")&&(t+=1)}))}_flushLingerScribes(){var e;const t=(null==(e=this._impressionTrackerV2)?void 0:e.flushLingerEvents())||[];this._scribeLingerEvents(t)}refreshOrGoTop(e){this._scroller&&!this._scroller.isAtNewest()?this.scrollToTop(e):this.props.onRefresh()}scrollAndFocusNewest(){this._scroller&&this._scroller.scrollToNewest(!0)}_proximityHandler(e){return t=>{this._positionedRestored&&e(t)}}_scribeNewEntries(e){const t=this._scheduleNewEntriesScribing(e);for(this._streamScribeCancelCallbacks.push(t);this._streamScribeCancelCallbacks.length>=20;)this._streamScribeCancelCallbacks.shift()}_buildStreamScribeData(e){const{handlerRegistry:t,scribeCache:n,timelineId:i}=this.props;if(!n.has(i)){const e=new Set;n.set(i,e)}const s=n.get(i);return s?e.reduce(((e,n,i)=>{const{entry:r,relativeElementHeight:o}=n,{entryId:a}=r;if(!s.has(a)&&!t.getNeedsLoad(r)){s.add(a);const n=this._getScribeDataItem(t,r);if(n){var c;const t=!(null==(c=r.content)||!c.promotedMetadata),i=this._promotedTweetDistanceMap.get(a);t&&i&&(n.tweet_count=i),null!=o&&(n.percent_screen_height_100k=o),e.push(n)}}return e}),[]):[]}_storeSeenIds(e){const{seenIds:t,seenIdsLatest:n,timelineId:i}=this.props;i!==re.d&&i!==re.b||!t?i!==re.c&&i!==re.a||!n||n.addNewTweets(e):t.addNewTweets(e)}_scribeLingerEvents(e){if(0===e.length)return;const{handlerRegistry:t}=this.props,n=this._getEntryIndex(),i=[],s=[];if(e.forEach((({end:e,id:r,start:o})=>{const a=n[r];if(a){const n=this._getScribeDataItem(t,a);if(n){const t={visibility_start:o,visibility_end:e};i.push({...n,impression_details:t})}if(a.type===ie.c.Tweet){const e=a;s.push(e.content.id)}if(a.type===ie.c.PagedCarouselItem){const e=a,t=e.content.content&&e.content.content.pagedCarouselFeedbackItem&&e.content.content.pagedCarouselFeedbackItem.content.tweet.id;t&&s.push(t)}}})),i.length>0){const{analytics:e,richScribeAction:t}=this.props;t({...e.contextualScribeNamespace,component:"stream",element:"linger",action:"results"},{items:i})}s.length>0&&this._storeSeenIds(s)}_getScribeDataItem(e,t){const n=e.getHandler(t);if(n)return n.getScribeDataItem(t)}_cancelStreamScribeCallbacks(){this._streamScribeCancelCallbacks.forEach((e=>e()))}}de.contextTypes={viewport:ee.object,featureSwitches:ee.any},de.defaultProps={onBottomRetry:R.a,onNearBottom:R.a,onNearTop:R.a,onRefresh:R.a,refreshControl:X.a,scribeCache:ce,scroller:Z.b,seenIds:Object(se.b)(),seenIdsLatest:Object(se.a)(),withoutHeadroom:!1,showLoadingFooter:!0,withKeyboardShortcuts:!0};t.default=Object(x.a)(de)},"ejT/":function(e,t,n){"use strict";n.d(t,"b",(function(){return i})),n.d(t,"a",(function(){return s}));const i=e=>({id:e,distanceToViewportTop:0}),s=e=>({id:e,distanceToViewportBottom:0})},pbku:function(e,t,n){"use strict";n.d(t,"a",(function(){return i}));const i=Object.freeze({ON_BLOCK_AUTHOR:"onBlockAuthor",ON_LINGER:"onLinger",ON_IS_RELEVANT:"onIsRelevant",ON_SHOW_MORE:"onShowMore",ON_LIKE:"onLike",ON_FOLLOW:"onFollow"})}}]);
//# sourceMappingURL=https://ton.local.twitter.com/responsive-web-internal/sourcemaps/client-web/loader.TimelineRenderer.e914c037.js.map